<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тест - HTML Entities в названиях партнеров</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background-color: #f8fafc;
        }
        .test-section {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
        }
        .pass {
            background-color: #dcfce7;
            color: #166534;
        }
        .fail {
            background-color: #fee2e2;
            color: #991b1b;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        th {
            background-color: #f8fafc;
            font-weight: 600;
        }
        code {
            background-color: #f1f5f9;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>Тестирование декодирования HTML entities в названиях партнеров</h1>

    <div class="test-section">
        <h2>Описание проблемы</h2>
        <p>В JSON данных партнеров могут содержаться HTML entities, такие как <code>&amp;quot;</code> вместо кавычек <code>"</code>.</p>
        <p>Эта страница тестирует функцию <code>decodeHtmlEntities()</code>, которая правильно декодирует эти символы.</p>
    </div>

    <div class="test-section">
        <h2>Тестовые данные</h2>
        <table>
            <thead>
                <tr>
                    <th>Оригинальная строка (с &amp;quot;)</th>
                    <th>Ожидаемый результат (с ")</th>
                    <th>Фактический результат</th>
                    <th>Статус</th>
                </tr>
            </thead>
            <tbody id="testResults">
            </tbody>
        </table>
    </div>

    <div class="test-section">
        <h2>Результаты тестирования</h2>
        <div id="summary"></div>
    </div>

    <script>
        // Copy the decodeHtmlEntities function from partners.html
        function decodeHtmlEntities(text){
            if(!text) return text;
            var txt = document.createElement('textarea');
            txt.innerHTML = text;
            return txt.value;
        }

        // Test cases
        var testCases = [
            {
                input: 'ООО &quot;Рога и копыта&quot;',
                expected: 'ООО "Рога и копыта"'
            },
            {
                input: 'Компания &quot;Успех&quot; и &quot;Процветание&quot;',
                expected: 'Компания "Успех" и "Процветание"'
            },
            {
                input: '&quot;Альфа&quot;-Банк',
                expected: '"Альфа"-Банк'
            },
            {
                input: 'ИП &quot;Иванов&quot;',
                expected: 'ИП "Иванов"'
            },
            {
                input: 'ООО Ромашка (без кавычек)',
                expected: 'ООО Ромашка (без кавычек)'
            },
            {
                input: '&quot;',
                expected: '"'
            },
            {
                input: '&lt;Тест&gt; &amp; &quot;кавычки&quot;',
                expected: '<Тест> & "кавычки"'
            },
            {
                input: '',
                expected: ''
            },
            {
                input: null,
                expected: null
            }
        ];

        // Run tests
        var passed = 0;
        var failed = 0;
        var tbody = document.getElementById('testResults');

        testCases.forEach(function(testCase, index){
            var result = decodeHtmlEntities(testCase.input);
            var isPassed = result === testCase.expected;

            if(isPassed){
                passed++;
            } else {
                failed++;
            }

            var tr = document.createElement('tr');

            var td1 = document.createElement('td');
            td1.textContent = testCase.input || '(пусто)';
            tr.appendChild(td1);

            var td2 = document.createElement('td');
            td2.textContent = testCase.expected || '(пусто)';
            tr.appendChild(td2);

            var td3 = document.createElement('td');
            td3.textContent = result || '(пусто)';
            tr.appendChild(td3);

            var td4 = document.createElement('td');
            var statusDiv = document.createElement('div');
            statusDiv.className = 'test-result ' + (isPassed ? 'pass' : 'fail');
            statusDiv.textContent = isPassed ? '✓ PASS' : '✗ FAIL';
            td4.appendChild(statusDiv);
            tr.appendChild(td4);

            tbody.appendChild(tr);
        });

        // Display summary
        var summary = document.getElementById('summary');
        var totalTests = testCases.length;
        var summaryHtml = '<h3>Итого:</h3>';
        summaryHtml += '<p>Всего тестов: ' + totalTests + '</p>';
        summaryHtml += '<p>Пройдено: <span style="color: #166534; font-weight: bold;">' + passed + '</span></p>';
        summaryHtml += '<p>Провалено: <span style="color: #991b1b; font-weight: bold;">' + failed + '</span></p>';

        if(failed === 0){
            summaryHtml += '<div class="test-result pass">✓ Все тесты пройдены успешно!</div>';
        } else {
            summaryHtml += '<div class="test-result fail">✗ Некоторые тесты провалились</div>';
        }

        summary.innerHTML = summaryHtml;
    </script>
</body>
</html>
